## Исследование пользовательской активности интернет-магазина

Цель компании «В один клик» — удерживать активность постоянных клиентов.

Исходя из этой цели, были сформулированы основные задачи проекта:

Создать модель МО, которая будет предсказывать: изменилась ли покупательская активность постоянных пользователей.
Изучить сегмент пользователей с высокой вероятностью снижения активности и дать предложения для её поддержания.
Для выполнения задач были проделаны следующие шаги:

1 Загрузка данных

Исходные данные были переданы следующим переменным:

market_main: данные о поведении покупателя на сайте, о коммуникациях с покупателем и его продуктовом поведении.
market_money: данные о выручке, которую получает магазин с покупателя, то есть сколько покупатель всего потратил за период взаимодействия с сайтом.
market_time: данные о времени (в минутах), которое покупатель провёл на сайте в течение периода.
money_mean_month: данные о среднемесячной прибыли продавца за последние 3 месяца: какую прибыль получает магазин от продаж каждому покупателю.
market_main:

Датафрейм market_main содержит 1300 наблюдений по 9-ти признакам.
По сводной статистике не выявили аномальных значений.
В признаке "Тип сервиса" выявили неявный дубликат среди значений.
market_money: датафрейм market_money содержит 3900 наблюдений по трём признакам.

market_time: датафрейм market_time состоит из 2600 строк по трём признакам.

money_mean_month: датафрейм money_mean_month содержит 1300 строк наблюдений по двум признакам.

2 Предобработка данных

Удалён неявный дубликат "стандартт" в признаке тип_сервиса.
Названия столбцов и значений сделаны более однотипными.
Внесены лёгкие эстетически правки.
3 Исследовательский анализ данных

market_main:

Количественные признаки:

маркет_актив_6_мес: значения от 0.9 до 6.6. Значения менее, чем примерно 2.4, воспринимаются ящиком с усами как статистические выбросы. Для решеня проблем с выбросами решено ввести новый категориальный признак. Отметим, что значения от 1 до 3 принадлежат пользователям в большей части со снизившейся активностью. Это могут быть пользователи, которые в целом редко посещают сайт.
маркет_актив_тек_мес: значения от 3 до 5. Значения 3 и 5 воспринимаются как выбросы, для решения проблемы введён категориальный признак.
длительность: распределение значений: 110—1079 дней. Распределение близко к нормальному.
акционные_покупки: значения от 0 до 0.99. На гистограмме наблюдаем два пика. Можно разделить покупателей на две группы: обычные клиенты и те, кто почти всегда берёт товары только по акции. Причём высокая доля акционных покупок больше характерна для пользователей со снизившейся активностью. Можно сказать, что у интересующей нас категории покупателей вероятнее снижается активность после завершения акций. Вероятно некоторые категории клиентов получали специальные предложения, иначе бы график был бы более близок к нрмальному распределению.
средний_просмотр_категорий_за_визит: Значения от 1-го до 6-ти. Распределение на гистограмме похоже на нормальное, смещено влево. Пользователи со снизившейся активностью в среднем просматривают меньше категорий. В целом уже можно предположить, что низкая активность на сайте более характерна для интересующей нас категории покупателей.
неоплаченные_продукты_штук_квартал: Значения от 0 до 10-ти. Значения больше 8-ми являются статистическими выбросами. Значения больше пяти более характерныны для пользователей со снизившейся активностью.
ошибка_сервиса: Значения от 0 до 9-ти. Наблюдаем нормальное распределение. Пользователи со снизившейся активностью реже сталкиваются с высокими значениями сбоев. Вероятно в силу того, что они в целом меньше взаимодействуют с сайтом.
страниц_за_визит: Значения от 1-ой до 20-ти страниц. Наблюдаем нормальное распределение со смещением влево. Выбросы отсутствуют. Как и предполагалось, пользователи со снизившейся активностью просматривают меньше страниц.
На основе изученных количественных признаков в датафрейм введены следующие категориальные признаки:

market_active_mean_cat: на основе данных признака маркет_актив_6_мес введены категориальные значения со следующим распределением: меньше 3 — 9.92%, 3—5 — 66.31%, больше 5 — 23.77%.
market_active_last_cat: на основе данных признака маркет_актив_тек_мес введены категориальные значения со следующим распределением: три — 23.69%, четыре — 51.46%, пять — 24.85%.
promotional_purchases_cat: на основе данных признака акционные_покупки введены категориальные значения со следующим распределением: регулярный покупатель — 87.15%, акционный покупатель — 12.85%.
unpaid_products_cat: на основе данных признака неоплаченные_продукты_штук_квартал введены категориальные значения со следующим распределением: не было неоплаченных товаров — 8.92%, один — 20.08%, два — 20.08%, три — 16.77%, четыре — 15.15%, пять — 10.38%, больше пяти — 8.62%.
Категориальные признаки:

покупательская_активность: прежний уровень — 61.69% клиентов, снизилась — 38.31%.
тип_сервиса: стандарт — 71.08% клиентов, премиум — 28.92%. Среди пользователей со снизившейся активностью доля пользователей с обслуживанием "Премиум" почти такая же как у пользователей со стандартным обслуживанием. Кажется, условия обслуживания "Премиум" не столь эфективно поддерживают активность, как моно было бы ожидать.
разрешить_сообщать: да — 74% клиентов, нет — 26%. Пользователи чаще соглашаются принимать дополнительные предложения. Для интересующей нас категории покупателей это так же характерно.
популярная_категория: товары для детей — 25.38% клиентов, домашний текстиль — 19.31%, косметика и аксессуары — 17.15%, техника для красоты и здоровья — 14.15%, мелкая бытовая техника и электроника — 13.38%, кухонная посуда — 10.62%. Доля пользователей со снизившейся активностью заметно ниже только среди категорий бытовой теники и техники для красоты и здоровья. Возможно, товары из остальных категории чаще оказываются в центре маркетинговых компаний или в специальных предложениях для пользователей.
market_money:

Обнаружили у пользователя 215380 сильный выброс в значениях выручки. Данные данного пользователя убрали из всех таблиц.
В позапрошлом месяце средняя выручка от пользователей со снизившейся активностью была заметно ниже, чем у активных. Начиная с прошлого месяца значения примерно выравнялись, да и в целом пользователи стали тратить больше. Возможно в прошлом месяце началась какая-то маркетинговая кампания.
market_time:

минут: распределение значений от 4-х до 23-х. На гистограмме наблюдаем нормальное распределене, выбросы отсутствуют.
период: два значения "текущий месяц" и "предыдущий месяц" равно распределены: по 1300 значений.
Пользователи со снизившейся активностью чаще проводят на сайте меньше времени.
money_mean_month: Значения прибыли от 0.86 до 7.43. Наблюдаем нормальное распределение.

По итогу анализа составили следующий портрет пользователя со снизившейся активностью:
В целом меньше взаимодействий с сайтом: в среднем около 10-12 минут в месяц, просматривают меньше категорий за визит, меньше страниц.
Чаще совершают покупки по акции.
Чаще имеют в корзине больше пяти неоплаченных товаров за квартал.
Чаще заинтересованы в следующих категориях товаров: товары для детей, косметика и аксессуары, домашний текстиль, кухонная посуда.
Обладают типом обслуживания "Премиум" почти так же часто, как и стандартные пользователи.
В конце исследовательского анализа отобрали активных покупателей: убрали из таблиц клиентов с нулевой выручкой хотя бы в один из месяцев.

4 Объединение таблиц

Объединили данные market_main, market_money и market_time в одну таблицу.

5 Корреляционный анализ

Избавились от признаков введённых прежде на этапе анализа данных категориальных признаков.

6 Использование пайплайнов

На данном этапе был создан пайплайн для подбора модели с лучшей предсказательной способностью. Для оценки качества модели была использована метрика ROC-AUC, так как она учитывает работу модели при всех возможных значениях порогов и поэтому не зависит от одного конкретного.

Лучше всех метрика качества у дерева решений с 3-мя уровнями с правилами и 4-мя признаками. Метрика лучшей модели на кросс-валидации: 0.8482418149554514
Метрика ROC-AUC на тестовой выборке: 0.8891315778829431

7 Анализ важности признаков

Создали график важности признаков и график SHAP-значений признаков.

Модель принимает решения на основе 4-ёх признаков:
Количество страниц за визит: самый важный признак.
Доля акционных покупок.
Выручка за позапрошлый месяц.
Среднее число маркетинговых коммуникаций за полгода.
Из анализа графика SHAP-значений отметили следующее:

Количество страниц за визит: малые значения увеличивают вероятность принадлежности к классу "снизилась".
Доля акционных покупок: большие значения увеличивают вероятность принадлежности к классу "снизилась".
Выручка за позапрошлый месяц: малые значения увеличивают вероятность принадлежности к классу "снизилась".
Среднее число маркетинговых коммуникаций за полгода: большие значения увеличивают вероятность принадлежности к классу "снизилась".
8 Сегментация покупателей

Итоги сегментации:

На данном этапе был выделен сегмент покупателей с наибольшей вероятностью снижения активности (от 0.80) и наибольшей среднемесячной прибылью (значения от 3-ёх).

Исходя из анализа целевого сегмента вывели его отличительные особенности и сформировали несколько предложений для повышения активности:

В среднем с целевым сегментом меньше коммуникаций, но если он в целом сходен с портретом целевого покупателя, то покупатели из целевого сегмента просто меньше проводят времени на сайте.
Целевой сегмент реже просматривает больше трёх категорий. Опять же объясняется это меньшей заинтересованностью в взаимодействии с сайтом.
Есть сходство с общим портретом клиентов со снизившейся активностью: целевой сегмент чаще имеет значения больше пяти неоплаченных товаров в корзине.
Целевой сегмент чаще составляют пользователи с долей акционных покупок больше 0.3. Похоже, что целевой сегмент в этом сходен с общим портретом пользователей со снизившейся активностью. Если так, то мы должны увидеть рост средней выручки от сегмента от позапрошлого месяца к прошлому.
Выручка за предпредыдущий месяц от целевого сегмента в среднем была ниже. А вот за прошлый месяц и текущий распределение довольно похожее. Да и в целом значения выручки выше. Вероятно это результат какой-то маркетинговой кампании. Акции очевидно хороший способ поднять активность целевого сегмента. Изучив разницу в выручке среди популярных категорий товаров, мы обнаружили, что в период акции целевой сегмент стал значительно активнее приносить выручку в категориях: домашний текстиль, косметика и аксессуары и кухонная посуда. Можно поднять активность целевого сегмента, если предлагать специальные предложения для товаров в данных категориях.
Доля класса "Премиум" в целевом сегменте, похоже, выше, чем в нецелевом. Может, будет не лишним провести опрос среди пользователей "Премиума", чего не хватает в обслуживании.
